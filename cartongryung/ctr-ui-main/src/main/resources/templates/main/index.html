<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout_main}">

<th:block layout:fragment="content">
    <div class="main-top">
        <th:block th:if="${!mainTopBannerLists.isEmpty()}">
            <div class="main-visual">
                <div class="swiper-control">
                    <div class="swiper-count">
                        <span class="active-num"></span>
                    </div>
                    <div class="pagination"></div>
                    <div class="swiper-count">
                        <span class="all-num"></span>
                    </div>
                    <a href="javascript:;" class="pause">정지</a>
                    <a href="javascript:;" class="play">재생</a>
                </div>
                <div class="swiper-navi">
                    <button type="button" class="swiper-button prev">이전</button>
                    <button type="button" class="swiper-button next">다음</button>
                </div>
                <div class="swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" th:each="top : ${mainTopBannerLists}">
                            <a th:href="${top.linkUrl}" th:target="${top.linkType.code}" class="img">
                                <!-- pc용 이미지 -->
                                <img th:src="@{/api/file/view/__${top.pcAttachment.uuid}__?size=1000}"
                                     alt="메인 배너" class="hide-m">
                                <!-- 모바일용 이미지 -->
                                <img th:src="@{/api/file/view/__${top.mobileAttachment.uuid}__?size=1000}"
                                     alt="메인 배너" class="hide-pc">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </th:block>
        <div class="w-set">
            <div class="main-cont">
                <div class="search-wrap">
                    <div class="tit-area">
                        <h2 class="tit hide-m">나에게 맞는 차량을 찾아보세요.</h2>
                        <div class="search-area">
                            <div class="search-box">
                                <p class="total"><strong
                                    th:text="${#numbers.formatInteger(productCount, 1, 'COMMA')}">139,671</strong>대
                                </p>
                                <input type="text" name="mainKeyword" id="searchBox">
                                <label for="searchBox" class="is-blind">검색창</label>
                                <button type="button" class="btn-search" onclick="searchMainKeyword()">검색</button>
                            </div>
                            <div class="search-list hide-m">
                                <div class="swiper">
                                    <div class="swiper-wrapper">
                                        <div class="swiper-slide" th:each="keyword : ${popularKeywordLists}">
                                            <a href="javascript:;" th:text="${keyword.makerName != null ? keyword.makerName : ''}
                                                    + ' ' + ${keyword.modelName != null ? keyword.modelName : ''}
                                                    + ' ' + ${keyword.detailModelName != null ? keyword.detailModelName : ''}">뉴카니발</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="swiper-navi">
                                    <button type="button" class="swiper-button prev">이전</button>
                                    <button type="button" class="swiper-button next">다음</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="select-wrap hide-m">
                        <div class="select-box on" id="category1">
                            <button type="button" class="select">제조사</button>
                            <ul class="option-list">
                                <li th:each="code : ${firstCategoryList}" th:if="${code.depth == 0}">
                                    <a href="javascript:;" onclick="selectCategory(this)"
                                       th:attr="data-id=${code.id}, data-depth=${code.depth}"
                                       th:text="${code.linkDataNm}">기아</a>
                                </li>
                            </ul>
                        </div>
                        <div class="select-box disabled" id="category2">
                            <button type="button" class="select" id="modelName">모델</button>
                            <ul class="option-list"></ul>
                        </div>
                        <div class="select-box disabled" id="category3">
                            <button type="button" class="select">세부모델</button>
                            <ul class="option-list"></ul>
                        </div>
                        <button type="button" class="btn" onclick="submitSearch()">Search</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="w-set">
            <div class="link-wrap hide-pc">
                <a href="/service01" class="link">
                    <i class="i-link1"></i>
                    <span class="txt">평생책임<br>서비스</span>
                </a>
                <a href="/event" class="link">
                    <i class="i-link2"></i>
                    <span class="txt">이벤트</span>
                </a>
                <a href="/review" class="link">
                    <i class="i-link3"></i>
                    <span class="txt">고객후기</span>
                </a>
                <a href="/map01" class="link">
                    <i class="i-link4"></i>
                    <span class="txt">오시는 길</span>
                </a>
            </div>
            <div class="main-cont">
                <!--  올아온지 얼마 안된 매물 -->
                <div class="new-wrap">
                    <div class="tit-area">
                        <h2 class="tit">올라 온 지 얼마 안된 매물</h2>
                    </div>
                    <div class="swiper-wrap new-slide">
                        <div class="swiper-control">
                            <div class="pagination"></div>
                        </div>
                        <div class="swiper-navi">
                            <button type="button" class="swiper-button prev">이전</button>
                            <button type="button" class="swiper-button next">다음</button>
                        </div>
                        <div class="swiper">
                            <div class="swiper-wrapper">
                                <!-- 매물 정보 반복 -->
                                <div class="swiper-slide" th:each="car : ${recentCarList}">
                                    <!-- 선착순 특가 badge -->
                                    <div class="prd-box"
                                         th:classappend="${car.shopName.contains('(주)디에스오토')} ? ' badge' : ''">
                                        <div class="prd-thumb">

                                            <label class="btn-like">
                                                <input type="checkbox"
                                                       th:attr="productId=${car.productId}"
                                                       th:checked="${car.picked}"
                                                       class="pick_check">
                                                <span class="like-visual">좋아요</span>
                                            </label>

                                            <a th:href="'/product/' + ${car.productId}">
                                                <!-- carImageUrl에서 첫 번째 이미지 사용 -->
                                                <img th:src="${car.carImageUrl[0].realUrl}"
                                                     alt="">
                                            </a>
                                        </div>
                                        <a th:href="'/product/' + ${car.productId}" class="prd-info">
                                            <p class="prd-name"
                                               th:text="${car.makerName + ' ' + car.modelName + ' ' + car.detailGradeName}">
                                                <!-- 메이커명, 모델명, 디테일 등급명 출력 -->
                                            </p>
                                            <p class="price-info">
                                                <!-- 판매 가격  출력 -->
                                                <span class="num-price"
                                                      th:text="${car.getFormattedCarAmountSale()}">13,700만원</span>
                                            </p>
                                            <p class="detail-info">
                                                <!-- 등록 연도, 주행 거리, 도시 정보 출력 -->
                                                <span th:text="${car.carRegYear}">2019/04(2019)</span>
                                                <span th:text="${#numbers.formatInteger(car.carUseKm, 1, 'COMMA') + ' km'}">11,179 km</span>
                                                <span th:text="${car.city}"> 서울</span>
                                            </p>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--올라온지 얼마 안된 매물 끝 -->
            </div>
        </div>
        <div class="main-cont type-bg">
            <div class="w-set">
                <div class="recommend-wrap">
                    <div class="tit-area">
                        <h2 class="tit">카통령 추천 차량</h2>
                    </div>
                    <div>
                        <div class="recommend-cont">
                            <div class="main-area" th:each="car, iterStat : ${cuvRecommendList}"
                                 th:if="${iterStat.index == 0}">
                                <div class="prd-box"
                                     th:classappend="${car.shopName.contains('(주)디에스오토')} ? ' badge' : ''">
                                    <div class="prd-thumb">
                                        <a th:href="'/product/' + ${car.productId}">
                                            <img th:src="${car.carImageUrl[0].realUrl}"
                                                 alt="">
                                        </a>
                                    </div>
                                    <a th:href="'/product/' + ${car.productId}" class="prd-info">
                                        <p class="prd-name"
                                           th:text="${car.makerName + ' ' + car.modelName + ' ' + car.detailGradeName}">
                                            기아 더 뉴 쏘렌토 4세대(MQ4) 디젤 2.2 2WD 노블레스(5인승) 길면</p>
                                        <p class="price-info">
                                                    <span class="num-price"
                                                          th:text="${car.getFormattedCarAmountSale()}">11,400만원</span>
                                        </p>
                                        <p class="detail-info">
                                            <span th:text="${car.carRegYear}">2019/04(2019)</span>
                                            <span th:text="${#numbers.formatInteger(car.carUseKm, 1, 'COMMA') + ' km'}">11,179 km</span>
                                            <span th:text="${car.city}">서울</span>
                                        </p>
                                    </a>
                                    <label class="btn-like">
                                        <input type="checkbox"
                                               th:attr="productId=${car.productId}"
                                               th:checked="${car.picked}"
                                               class="pick_check">
                                        <span class="like-visual">좋아요</span>
                                    </label>
                                </div>
                            </div>
                            <div class="cont-area">
                                <ul class="prd-list prd-row">
                                    <li th:each="car, iterStat : ${cuvRecommendList}"
                                        th:if="${iterStat.index != 0}">
                                        <div class="prd-box badge">
                                            <div class="prd-thumb">
                                                <a th:href="'/product/' + ${car.productId}">
                                                    <img th:src="${car.carImageUrl[0].realUrl}"
                                                         alt="">
                                                </a>
                                            </div>
                                            <a th:href="'/product/' + ${car.productId}" class="prd-info">
                                                <p class="prd-name"
                                                   th:text="${car.makerName + ' ' + car.modelName + ' ' + car.detailGradeName}">
                                                    기아 더 뉴 쏘렌토</p>
                                                <p class="price-info">
                                                            <span class="num-price"
                                                                  th:text="${car.getFormattedCarAmountSale()}">11,400만원</span>
                                                </p>
                                                <p class="detail-info">
                                                    <span th:text="${car.carRegYear}">2019/04(2019)</span>
                                                    <span
                                                        th:text="${#numbers.formatInteger(car.carUseKm, 1, 'COMMA') + ' km'}">11,179 km</span>
                                                    <span th:text="${car.city}">서울</span>
                                                </p>
                                            </a>
                                            <label class="btn-like">
                                                <input type="checkbox"
                                                       th:attr="productId=${car.productId}"
                                                       th:checked="${car.picked}"
                                                       class="pick_check">
                                                <span class="like-visual">좋아요</span>
                                            </label>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="w-set">
            <th:block th:if="${!mainSubBannerLists.isEmpty()}">
                <div class="main-cont">
                    <div class="sub-visual">
                        <div class="swiper-count"></div>
                        <div class="swiper">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide" th:each="sub : ${mainSubBannerLists}">
                                    <a th:href="${sub.linkUrl}" th:target="${sub.linkType.code}">
                                        <!-- pc용 이미지 -->
                                        <img th:src="@{/api/file/view/__${sub.pcAttachment.uuid}__?size=1000}"
                                             alt="서브 배너" class="for-pc">
                                        <!-- 모바일용 이미지 -->
                                        <img th:src="@{/api/file/view/__${sub.mobileAttachment.uuid}__?size=1000}"
                                             alt="서브 배너" class="for-t">
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
            <div class="main-cont">
                <div class="efficient-wrap">
                    <div class="tit-area">
                        <h2 class="tit">가성비 추천 차량</h2>
                    </div>
                    <div class="swiper-wrap efficient-slide">
                        <div class="swiper-control">
                            <div class="pagination"></div>
                        </div>
                        <div class="swiper-navi">
                            <button type="button" class="swiper-button prev">이전</button>
                            <button type="button" class="swiper-button next">다음</button>
                        </div>
                        <div class="swiper">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide" th:each="car : ${bestValueRecommendList}">
                                    <div class="prd-box">
                                        <div class="prd-thumb">
                                            <label class="btn-like">
                                                <input type="checkbox"
                                                       th:attr="productId=${car.productId}"
                                                       th:checked="${car.picked}"
                                                       class="pick_check">
                                                <span class="like-visual">좋아요</span>
                                            </label>
                                            <a th:href="'/product/' + ${car.productId}">
                                                <img th:src="${car.carImageUrl[0].realUrl}"
                                                     alt="">
                                            </a>
                                        </div>
                                        <<a th:href="'/product/' + ${car.productId}" class="prd-info">
                                        <p class="prd-name"
                                           th:text="${car.makerName + ' ' + car.modelName + ' ' + car.detailGradeName}">
                                            아 더 뉴 쏘렌토 4세대(MQ4) 디젤 2.2 2WD 노블레스(5인승)아 더 뉴
                                            쏘렌토 4세대(MQ4) 디젤 2.2 2WD 노블레스(5인승)</p>
                                        <p class="price-info">
                                                    <span class="num-price"
                                                          th:text="${car.getFormattedCarAmountSale()}">11,400만원</span>
                                        </p>
                                        <p class="detail-info">
                                            <span th:text="${car.carRegYear}">2019/04(2019)</span>
                                            <span th:text="${#numbers.formatInteger(car.carUseKm, 1, 'COMMA') + ' km'}">11,179 km</span>
                                            <span th:text="${car.city}">서울</span>
                                        </p>
                                    </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <th:block th:if="${!eventLists.isEmpty()}">
                <div class="main-cont">
                    <div class="event-wrap">
                        <div class="tit-area">
                            <h2 class="tit">카통령 이벤트</h2>
                            <a href="/event" class="btn-more">더보기</a>
                        </div>
                        <div class="swiper-wrap event-slide">
                            <div class="swiper-control">
                                <div class="pagination"></div>
                            </div>
                            <div class="swiper-navi">
                                <button type="button" class="swiper-button prev">이전</button>
                                <button type="button" class="swiper-button next">다음</button>
                            </div>
                            <div class="swiper">
                                <div class="swiper-wrapper">
                                    <div class="swiper-slide" th:each="event : ${eventLists}">
                                        <a th:href="@{/event/__${event.id}__}">
                                            <div class="event-img">
                                                <!-- pc용 이미지 -->
                                                <img th:src="@{/api/file/view/__${event.pcAttachment.uuid}__?size=500}"
                                                     alt="이벤트 배너" class="hide-m">
                                                <!-- 모바일용 이미지 -->
                                                <img
                                                    th:src="@{/api/file/view/__${event.mobileAttachment.uuid}__?size=500}"
                                                    alt="이벤트 배너" class="hide-pc">
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </th:block>
            <div class="main-cont">
                <div class="review-wrap">
                    <div class="tit-area">
                        <h2 class="tit">이용후기</h2>
                        <a href="/review" class="btn-more">더보기</a>
                    </div>
                    <div class="swiper-wrap review-slide">
                        <div class="swiper-control">
                            <div class="pagination"></div>
                        </div>
                        <div class="swiper-navi">
                            <button type="button" class="swiper-button prev">이전</button>
                            <button type="button" class="swiper-button next">다음</button>
                        </div>
                        <div class="swiper">
                            <div class="swiper-wrapper">
                                <div th:each="review : ${reviewList}" class="swiper-slide">
                                    <a th:href="@{/review/__${review.id}__}">
                                        <div class="prd-box">
                                            <div class="prd-thumb">
                                                <img th:src="${review.attachment != null ?
                                                    review.attachment.realUrl : '/user/images/dummy/sample03.png'}"
                                                    alt="리뷰 이미지">
                                            </div>
                                            <div class="prd-info">
                                                <div class="profile">
                                                    <img th:src="@{${review.profileImageJson.realUrl}}" alt="프로필 이미지">
                                                </div>
                                                <p class="review-tit" th:text="${review.title}">Review Title</p>
                                                <p class="review-txt" th:utext="${review.content}">Review
                                                    Content</p>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="notice-wrap">
            <div class="w-set">
                <span class="tit">공지사항</span>
                <th:block th:if="${boardNotice ne null}">
                    <a th:href="@{/board/notice/__${boardNotice.id}__}" class="txt-area">
                        <p class="txt" th:text="${boardNotice.title}">홈페이지가 오픈 되었습니다</p>
                        <span class="date" th:text="${#temporals.format(boardNotice.createdAt, 'yy.MM.dd')}">24-04-04</span>
                    </a>
                </th:block>
            </div>
        </div>
    </div>
</th:block>

<script layout:fragment="script" th:inline="javascript">
    // 카테고리 초기화
    let selectedCategory = {
        category1 : '',
        category2 : '',
        category3 : []
    };


    // 메인 페이지 카테고리 1,2,3 검색
    function searchMainKeyword() {
        let keywordValue = document.querySelector('input[name="mainKeyword"]').value
        fetch("/api/search/product", {
            method:"POST",
            headers : {"Content-Type" : "application/json"},
            body : JSON.stringify({keyword: keywordValue})
        })
            .then(res=>res.json())
            .then(result => {
                if(result.code === 200) {
                    sessionStorage.setItem("searchResults", JSON.stringify(result.data))
                    location.href = "/search/product"
                }
            })
    }


    // 카테고리 2 및 3을 리셋하는 함수
    function resetCategory(level) {
        if (level == 2) {
            let category2 = document.getElementById("category2");
            category2.querySelector("button.select").innerText = "모델";
            selectedCategory.category2 = null;
            category2.querySelector(".option-list").innerHTML = "";
            category2.classList.add("disabled");
            category2.classList.remove("on");
        }
        if (level == 3) {
            let category3 = document.getElementById("category3");
            category3.querySelector("button.select").innerText = "세부모델";
            selectedCategory.category3 = [];
            category3.querySelector(".option-list").innerHTML = "";
            category3.classList.add("disabled");
            category3.classList.remove("on");
        }
    }

    // 1차 카테고리 선택 함수
    function selectCategory(_this) {
        let id = _this.getAttribute("data-id");
        let depth = parseInt(_this.getAttribute("data-depth"));

        fetch("/api/search/category", {
            method : "POST",
            headers : {"Content-Type" : "application/json"},
            body : JSON.stringify({categoryId : id, depth : depth + 1})
        })
            .then(res => res.json())
            .then(result => {
                if(result.code === 200) {
                    console.log(result.data)
                    let name = _this.innerText;

                    let category1 = document.getElementById("category1");
                    category1.querySelector("button.select").innerText = name;
                    selectedCategory.category1 = id;
                    resetCategory(2);
                    resetCategory(3);

                    let category2 = document.getElementById("category2");
                    let modelOptionList = category2.querySelector(".option-list");
                    category2.classList.add("on");
                    category2.classList.remove("disabled");

                    modelOptionList.innerHTML = '';
                    result.data.forEach((item) => {
                        if (item.depth == 1 && item.parentId == id) {
                            let li = document.createElement("li");
                            let a = document.createElement("a");
                            a.href = "javascript:;";
                            a.setAttribute("data-id", item.id);
                            a.setAttribute("data-depth", item.depth)
                            a.innerText = item.linkDataNm;
                            a.onclick = function () {
                                selectModel(this);
                            };
                            li.appendChild(a);
                            modelOptionList.appendChild(li);
                        }
                    });

                    console.log(modelOptionList)
                }
            })

        console.log("Category 1 selected:", selectedCategory);
    }

    // 2차 카테고리 선택 함수
    function selectModel(_this2) {
        let id = _this2.getAttribute("data-id");
        let depth = parseInt(_this2.getAttribute("data-depth"));
        let name = _this2.innerText;

        console.log(id)
        fetch("/api/search/category", {
            method : "POST",
            headers : {"Content-Type" : "application/json"},
            body : JSON.stringify({categoryId : id, depth : depth + 1})
        })
            .then(res => res.json())
            .then(result => {
                if(result.code == 200) {
                    console.log(result.data)
                    let category2 = document.getElementById("category2");
                    category2.querySelector("button.select").innerText = name;
                    selectedCategory.category2 = id;
                    resetCategory(3);

                    let category3 = document.getElementById("category3");
                    let detailModelOptionList = category3.querySelector(".option-list");
                    category3.classList.remove("disabled");
                    category3.classList.add("on");

                    detailModelOptionList.innerHTML = ''; // Clear previous options
                    result.data.forEach((item) => {
                        if (item.depth == 2 && item.parentId == id) {
                            let li = document.createElement("li");
                            let a = document.createElement("a");
                            a.href = "javascript:;";
                            a.setAttribute("data-id", item.id);
                            a.innerText = item.linkDataNm;
                            a.onclick = function () {
                                selectDetailModel(this);
                            };
                            li.appendChild(a);
                            detailModelOptionList.appendChild(li);
                        }
                    });

                    console.log("Model selected:", selectedCategory);
                }  else {
                    console.log("Error:", result.message)
                }
            })
            .catch(error => console.error('Error:', error));

    }

    // 비동기 검색 데이터 삭제 해주기
    document.addEventListener("DOMContentLoaded", () => {
        let sessionStorageData = sessionStorage.getItem("searchResults");
        if(sessionStorageData) {
            sessionStorage.removeItem("searchResults");
        }
    })

    // 3차 카테고리 선택 함수
    function selectDetailModel(_this) {
        let id = _this.getAttribute("data-id");
        let name = _this.innerText;

        let category3 = document.getElementById("category3");
        category3.querySelector("button.select").innerText = name;
        selectedCategory.category3.push(id);

        category3.classList.remove("on");
        category3.classList.add("disabled");

        console.log("Detail model selected:", selectedCategory);
    }


    // 검색을 제출하는 함수
    function submitSearch() {

        console.log(selectedCategory)


        fetch('/api/search/product', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(selectedCategory)
        })
            .then(response => response.json())
            .then(data => {
                console.log(data.data)

                sessionStorage.setItem('searchResults', JSON.stringify(data.data));
                location.href = '/search/product';
            })
            .catch(error => console.error('Error:', error));
    }


    // 메인 팝업
    var handleStorage = {
        // 스토리지에 데이터 쓰기(이름, 만료일)
        setStorage: function (name, exp) {
            // 만료 시간 구하기(exp를 ms단위로 변경)
            var date = new Date();
            date = date.setTime(date.getTime() + exp * 24 * 60 * 60 * 1000);

            // 로컬 스토리지에 저장하기
            // (값을 따로 저장하지 않고 만료 시간을 저장)
            localStorage.setItem(name, date)
        },
        // 스토리지 읽어오기
        getStorage: function (name) {
            var now = new Date();
            now = now.setTime(now.getTime());
            // 현재 시각과 스토리지에 저장된 시각을 각각 비교하여
            // 시간이 남아 있으면 true, 아니면 false 리턴
            return parseInt(localStorage.getItem(name)) > now
        }
    };

    // Check if the user has chosen not to see the popup again
    if (!handleStorage.getStorage('promoshowtime')) {
        // Display the popup
        if (document.querySelector('#mainPopupBg') && document.querySelector('#mainPopup')) {
            document.querySelector('#mainPopupBg').style.display = '';
            document.querySelector('#mainPopup').style.display = '';
        }

        const mainpopSwiper = new Swiper('#mainPopup .swiper', {
            autoplay: true,
            speed: 800,
            loop: true,
            autoHeight: true,
            pagination: {
                el: '#mainPopup .swiper-count',
                type: 'fraction',
                // 갯수 표현 마크업
                renderFraction: function (currentClass, totalClass) {
                    return `<span class="${currentClass}"></span>` +
                        `<em>/</em>` +
                        `<span class="${totalClass}"></span>`;
                }
            },
            navigation: {
                nextEl: '#mainPopup .swiper-navi .next',
                prevEl: '#mainPopup .swiper-navi .prev',
            },
        });

        // 일반 닫기 이벤트
        document.querySelectorAll('.mp-close').forEach(($el) => {
            $el.addEventListener('click', (e) => {
                if (document.querySelector('#mainPopupBg') && document.querySelector('#mainPopup')) {
                    document.querySelector('#mainPopupBg').remove();
                    document.querySelector('#mainPopup').remove();
                }
            });
        });

        // 그만보기 체크
        if (document.querySelector('.mp-close.mp-close-day')) {
            document.querySelector('.mp-close.mp-close-day').addEventListener('click', () => {
                // 하루동안 보지 않게 세팅
                handleStorage.setStorage('promoshowtime', 1);
            });
        }
    }

    // 메인비쥬얼 슬라이드
    const mainSlide = new Swiper('.main-visual .swiper', {
        slidesPerView: 1,
        loop: true,
        speed: 800,
        autoplay: {
            delay: 3000,
            disableOnInteraction: false,
        },
        pagination: {
            el: ".main-visual .pagination",
            type: "progressbar"
        },
        on: {
            beforeInit: function () {
                var slideCnt = this.wrapperEl.querySelectorAll(".main-visual .swiper-slide").length;
                $('.main-visual .active-num').text(pad(1, 2));
                $('.main-visual .all-num').text(pad(slideCnt, 2));
            },
            init: function () {
                var swiper = this;
                $(".main-visual .play").on("click", function () {
                    swiper.autoplay.start();
                });
                $(".main-visual .pause").on("click", function () {
                    swiper.autoplay.stop();
                });
            },
            activeIndexChange: function () {
                $('.main-visual .active-num').text(pad((this.realIndex + 1), 2));
            },
        },
        navigation: {
            nextEl: '.main-visual .swiper-navi .next',
            prevEl: '.main-visual .swiper-navi .prev',
        }
    });

    function pad(num, size) {
        var s = num + "";
        while (s.length < size) s = "0" + s;
        return s;
    }


    // 나에게 맞는 차량
    const searchSlide = new Swiper('.search-list .swiper', {
        slidesPerView: 4.6,
        speed: 800,
        spaceBetween: 10,
        autoplay: {
            delay: 3000,
        },
        navigation: {
            nextEl: '.search-list .swiper-navi .next',
            prevEl: '.search-list .swiper-navi .prev',
        },
    });

    // 올라 온 지 얼마 안된 매물 슬라이드
    const newSlide = new Swiper('.new-wrap .new-slide .swiper', {
        slidesPerView: 1.65,
        slidesPerGroup: 1,
        speed: 800,
        spaceBetween: 12,
        slidesOffsetAfter: 16,
        autoplay: {
            delay: 3000,
        },
        pagination: {
            el: ".new-wrap .new-slide .pagination",
            type: "progressbar"
        },
        navigation: {
            nextEl: '.new-wrap .new-slide .swiper-navi .next',
            prevEl: '.new-wrap .new-slide .swiper-navi .prev',
        },
        breakpoints: {
            768: {
                slidesPerView: 3,
                slidesPerGroup: 3,
                slidesOffsetAfter: 0,
            },
            1024: {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 16,
                slidesOffsetAfter: 0,
            }
        }
    });

    const newContainer = document.querySelector('.new-wrap .new-slide');

    newContainer.addEventListener('mouseenter', () => {
        newSlide.autoplay.stop();
    });

    newContainer.addEventListener('mouseleave', () => {
        newSlide.autoplay.start();
    });

    // 서브배너 슬라이드
    const subSlide = new Swiper('.sub-visual .swiper', {
        slidesPerView: 1,
        speed: 800,
        autoplay: {
            delay: 3000,
        },
        pagination: {
            el: '.sub-visual .swiper-count',
            type: 'fraction',
            // 갯수 표현 마크업
            renderFraction: function (currentClass, totalClass) {
                return `<span class="${currentClass}"></span>` +
                    `<em>/</em>` +
                    `<span class="${totalClass}"></span>`;
            }
        },

    });

    // 가성비 추천 차량 슬라이드
    const efficientSlide = new Swiper('.efficient-wrap .efficient-slide .swiper', {
        slidesPerView: 1.65,
        slidesPerGroup: 1,
        speed: 800,
        spaceBetween: 14,
        slidesOffsetAfter: 16,
        autoplay: {
            delay: 3000,
        },
        pagination: {
            el: ".efficient-wrap .efficient-slide .pagination",
            type: "progressbar"
        },
        navigation: {
            nextEl: '.efficient-wrap .efficient-slide .swiper-navi .next',
            prevEl: '.efficient-wrap .efficient-slide .swiper-navi .prev',
        },
        breakpoints: {
            768: {
                slidesPerView: 3,
                slidesPerGroup: 3,
                slidesOffsetAfter: 0,
            },
            1024: {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 16,
                slidesOffsetAfter: 0,
            },
            1400: {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 24,
                slidesOffsetAfter: 0,
            }
        }
    });

    const efficientContainer = document.querySelector('.efficient-wrap .efficient-slide');

    efficientContainer.addEventListener('mouseenter', () => {
        efficientSlide.autoplay.stop();
    });

    efficientContainer.addEventListener('mouseleave', () => {
        efficientSlide.autoplay.start();
    });

    // 이벤트 슬라이드
    const eventSlide = new Swiper('.event-wrap .event-slide .swiper', {
        slidesPerView: 1,
        slidesPerGroup: 1,
        speed: 800,
        spaceBetween: 0,
        autoplay: {
            delay: 3000,
        },
        pagination: {
            el: ".event-wrap .event-slide .pagination",
            type: "progressbar"
        },
        navigation: {
            nextEl: '.event-wrap .event-slide .swiper-navi .next',
            prevEl: '.event-wrap .event-slide .swiper-navi .prev',
        },
        breakpoints: {
            1024: {
                slidesPerView: 2,
                slidesPerGroup: 2,
                spaceBetween: 24,
            }
        }
    });

    // 이용후기 슬라이드
    const reviewSlide = new Swiper('.review-wrap .review-slide .swiper', {
        slidesPerView: 2.1,
        slidesPerGroup: 1,
        speed: 800,
        spaceBetween: 10,
        slidesOffsetAfter: 16,
        autoplay: {
            delay: 3000,
        },
        pagination: {
            el: ".review-wrap .review-slide .pagination",
            type: "progressbar"
        },
        navigation: {
            nextEl: '.review-wrap .review-slide .swiper-navi .next',
            prevEl: '.review-wrap .review-slide .swiper-navi .prev',
        },
        breakpoints: {
            768: {
                slidesPerView: 3,
                slidesPerGroup: 3,
                spaceBetween: 20,
                slidesOffsetAfter: 0,
            },
            1024: {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 24,
                slidesOffsetAfter: 0,
            }
        }
    });

    $(document).on("click", function (event) {
        // .search-box 내에서 클릭된 경우에는 total을 숨깁니다.
        if ($(event.target).closest('.search-box').length) {
            $('.search-box .total').css('display', 'none');
        } else {
            // .search-box 외의 영역 클릭 시에는 total을 보여줍니다.
            // 그리고 입력란에 텍스트가 있는 경우에는 total을 숨깁니다.
            if ($('.search-box input').val().trim() === '') {
                $('.search-box .total').css('display', 'block');
            } else {
                $('.search-box .total').css('display', 'none');
            }
        }
    });

    $('.search-box input').on("click", function () {
        // input을 클릭하면 total을 숨깁니다.
        $(this).parent().find('.total').css('display', 'none');
    });

    // 서버에서 픽의 productId 가져오기
    async function getProductIdOfPick() {
        try {
            const response = await fetch("/api/sub/getProductIdOfPick");
            const data = await response.json();
            return data; // 서버에서 받은 데이터 반환
        } catch (error) {
            console.error('Error:', error);
            return []; // 에러 발생 시 빈 배열 반환
        }
    }

    // 서버에서 픽의 delYN 가져오기
    async function getDelYNOfPick(productId) {
        console.log("sadfas " + productId);
        try {
            const response = await fetch(`/api/sub/getDelYNOfPick/${productId}`);
            const data = await response.json();
            console.log(data);
            return data; // 서버에서 받은 데이터 반환
        } catch (error) {
            console.error('Error:', error);
            return []; // 에러 발생 시 빈 배열 반환
        }
    }

    // 픽하기 동적 반영
    async function handleInsertPickCheck() {
        // 서버에서 픽의 productId 가져오기
        let prodList = await getProductIdOfPick();

        if (prodList.length !== 0) {
            document.querySelectorAll(".pick_check").forEach(item => {
                // 서버에서 가져온 픽리스트 안에 productId가 있으면
                if (prodList.length !== 0) {
                    // productId의 데이터 타입 int로 변환해서 비교하기
                    if (prodList.includes(parseInt(item.getAttribute("productId")))) {
                        item.checked = true;
                    }
                }
            });
        }
    }

    // 픽 취소하기 동적 반영
    async function handleDeletePickCheck(productId) {
        // 서버에서 픽의 productId 가져오기
        let delList = await getDelYNOfPick(productId);

        if (delList.length !== 0) {
            document.querySelectorAll(".pick_check").forEach(item => {
                // 서버에서 가져온 픽리스트 안에 productId가 있으면
                if (delList.length !== 0) {
                    item.checked = false;

                }
            });
        }
    }

    // 좋아요 누르면 픽에 추가됨
    document.querySelectorAll(".pick_check").forEach(tag => {
        tag.addEventListener("click", function () {
            let productId = tag.getAttribute("productId");
            fetch("/api/sub/pick/v2", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    productId: productId,
                })
            })
                .then(res => res.json())
                .then(result => {
                    if (result.code !== 200) {
                        $popup.alert(result.message, {
                            modal: true,
                            close: () => {
                                location.reload();
                            }
                        })
                        // 픽이 이미 db에 들어간 상태
                    }

                        // 픽 제거하기
                    // 클릭하면 즉시 false됨 따라서 클릭한 거랑 같은 productId 지닌 것 불빛 x
                    else if (tag.checked === false) {
                        console.log("제거진입")
                        handleDeletePickCheck(productId);
                    }

                    // 픽하기
                    else if (tag.checked === true) {
                        console.log("진입")
                        handleInsertPickCheck();
                    }
                })
        })
    })

</script>
</html>
